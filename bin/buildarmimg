#! /bin/bash

# Set globals
_LIBDIR=/usr/share/manjaro-arm-tools/lib

#imports
source ../lib/functions.sh

#Arguments 
opt=":e:d:v:h"

while getopts "${opt}" arg; do
  case $arg in
    e)
      edition="${OPTARG}"
      ;;
    d)
      device="${OPTARG}"
      ;;
    v)
      version="${OPTARG}"
      ;;
    \?)
      echo "Invalid option: -${OPTARG}"
      exit 1
      ;;
    h|?)
      usage_build_img
      exit 1
      ;;
    :)
      echo "Option -${OPTARG} requires an argument."
      exit 1
      ;;
  esac
done


_IMGNAME=Manjaro-ARM-$edition-$device-$version

   
if [[ "$device" = "oc2" ]]; then
    _ARCH='aarch64'
else
    _ARCH='armv7h'
fi

#Package lists
PKG_DEVICE=$(curl https://gitlab.com/Strit/arm-profiles/raw/master/devices/$device)
PKG_EDITION=$(curl https://gitlab.com/Strit/arm-profiles/raw/master/editions/$edition)
SRV_EDITION=$(curl https://gitlab.com/Strit/arm-profiles/raw/master/services/$edition)

create_rootfs_img

create_img

create_zip

