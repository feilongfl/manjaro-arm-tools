#!/bin/bash

# Set globals
LIBDIR=/usr/share/manjaro-arm-tools/lib

#imports
source $LIBDIR/functions.sh

#Arguments 
opt=":p:a:h"

while getopts "${opt}" arg; do
  case $arg in
    p)
      PACKAGE="${OPTARG%/}"
      ;;
    a)
      ARCH="${OPTARG}"
      ;;
    \?)
      echo "Invalid option: -${OPTARG}"
      exit 1
      ;;
    h|?)
      usage_build_pkg
      exit 1
      ;;
    :)
      echo "Option -${OPTARG} requires an argument."
      exit 1
      ;;
  esac
done

#Need both package and architecture
if [ "x" == "x$PACKAGE" ]; then
  echo "-p [option] is required"
  exit
fi

#Build the 'any' packages on aarch64
if [ $ARCH == "any" ]; then
	ARCH="aarch64"
fi

# start the timer
timer_start=$(get_timer)

#create the rootfs to build in
create_rootfs_pkg

#build the package
build_pkg

#export the package and clean up
export_and_clean

# show timer
show_elapsed_time "${FUNCNAME}" "${timer_start}"
