#!/bin/bash

#Usage: buildarmpkg package architecture.
#Example: buildarmpkg filesystem armv7h

# Set globals
LIBDIR=/usr/share/manjaro-arm-tools/lib

#imports
source $LIBDIR/functions.sh

#Arguments 
opt=":p:a:h"

while getopts "${opt}" arg; do
  case $arg in
    p)
      package="${OPTARG%/}"
      ;;
    a)
      arch="${OPTARG}"
      ;;
    \?)
      echo "Invalid option: -${OPTARG}"
      exit 1
      ;;
    h|?)
      usage_build_pkg
      exit 1
      ;;
    :)
      echo "Option -${OPTARG} requires an argument."
      exit 1
      ;;
  esac
done

#Need both package and architecture
if [ "x" == "x$package" ]; then
  echo "-p [option] is required"
  exit
fi

#Build the 'any' packages on armv7
if [ $arch == "any" ]; then
	arch="armv7h"
fi

#create the rootfs to build in
create_rootfs_pkg

#build the package
build_pkg

#export the package and clean up
export_and_clean
